<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1" />
    <title>RFP Assistant</title>
    <style>
      /* Hide Vite error overlay */
      #vite-error-overlay { display: none !important; }
      .vite-error-overlay { display: none !important; }
    </style>
    <script>
      // Ultimate Vite WebSocket error fix
      (function() {
        // 1. Override WebSocket before anything else loads
        const RealWebSocket = window.WebSocket;
        const wsInstances = new WeakSet();
        
        window.WebSocket = new Proxy(RealWebSocket, {
          construct(target, args) {
            let url = args[0];
            
            // Fix malformed URLs
            if (typeof url === 'string') {
              if (url.includes('undefined')) {
                console.debug('[WS Fix] Blocking malformed WebSocket URL:', url);
                // Return a mock that mimics a closed WebSocket
                const mock = Object.create(target.prototype);
                mock.readyState = 3; // CLOSED
                mock.url = url;
                mock.close = () => {};
                mock.send = () => { throw new Error('WebSocket is already in CLOSING or CLOSED state'); };
                mock.addEventListener = () => {};
                mock.removeEventListener = () => {};
                mock.dispatchEvent = () => false;
                
                // Trigger close event asynchronously
                setTimeout(() => {
                  if (mock.onclose) mock.onclose(new CloseEvent('close'));
                }, 0);
                
                return mock;
              }
            }
            
            try {
              const instance = new target(...args);
              wsInstances.add(instance);
              return instance;
            } catch (error) {
              console.debug('[WS Fix] WebSocket creation failed:', error.message);
              throw error;
            }
          }
        });
        
        // 2. Override console methods to filter out Vite errors
        const originalError = console.error;
        const originalWarn = console.warn;
        
        console.error = function(...args) {
          const msg = args.join(' ');
          if (msg.includes('[vite]') && msg.includes('websocket')) return;
          if (msg.includes('localhost:undefined')) return;
          originalError.apply(console, args);
        };
        
        console.warn = function(...args) {
          const msg = args.join(' ');
          if (msg.includes('[vite]') && msg.includes('websocket')) return;
          if (msg.includes('localhost:undefined')) return;
          originalWarn.apply(console, args);
        };
        
        // 3. Catch all errors
        window.addEventListener('error', function(e) {
          if (e.message && (e.message.includes('WebSocket') || e.message.includes('undefined'))) {
            e.preventDefault();
            e.stopPropagation();
            return true;
          }
        }, true);
        
        window.addEventListener('unhandledrejection', function(e) {
          if (e.reason && e.reason.message && 
              (e.reason.message.includes('WebSocket') || e.reason.message.includes('undefined'))) {
            e.preventDefault();
            e.stopPropagation();
            return true;
          }
        }, true);
      })();
    </script>
  </head>
  <body>
    <div id="root"></div>
    <script type="module" src="/src/main.tsx"></script>
    <!-- This is a replit script which adds a banner on the top of the page when opened in development mode outside the replit environment -->
    <script type="text/javascript" src="https://replit.com/public/js/replit-dev-banner.js"></script>
  </body>
</html>